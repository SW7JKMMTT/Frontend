import { Component, Input, ElementRef, ViewChild, Optional }   from '@angular/core';
import { IntervalObservable }                           from 'rxjs/observable/IntervalObservable';
import { MapService }                                   from '../Services/map.services';
import { MapComponent }                                 from './Map.component'

declare var L: any;

@Component({
    moduleId: module.id.replace("/dist/", "/"),
    selector: 'polyline',
    templateUrl: 'line.html',
    styleUrls: ['line.css']
})

export class PolylineElement {
    polyline : any = null;
    isStarted : boolean = false;
    car : any;

    @Input() route : Array<Array<number>> = [];

    new_icon = L.icon({
        iconUrl: 'data:image/png;base64,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',
        iconSize: [64, 64],
        iconAnchor: [32, 66],
    });

    start_icon = L.icon({
        iconUrl: 'assets/images/start.png',
        iconSize: [16, 16],
    });

    constructor(private MapService : MapService, @Optional() private MapComponent?: MapComponent){}

    ngOnInit(){
        if (this.MapComponent) {
            let map = this.MapService.getMap();

            this.polyline = new L.polyline(this.route, null);
            this.polyline.addTo(map);


            if(this.route.length > 0){
                let start = new L.marker([this.route[0][0], this.route[0][1]], {icon: this.start_icon});
                start.addTo(map);

                this.car = new L.marker([this.route[0][0], this.route[0][1]], {icon: this.new_icon}).on('click', function() { alert('JA'); } );
                this.car.addTo(map);

                this.isStarted = true;
            }
        } else {
          console.warn("This polyline-element will not be rendered \n the expected parent node of polyline-element should be either leaf-element or leaflet-group");
        }
    }

    ngDoCheck(inputChanges){
        let same = true;
        let cur_cords = this.polyline.getLatLngs();
        
        if(this.route.length != cur_cords.length){
            let map = this.MapService.getMap();

            map.removeLayer(this.polyline);

            this.polyline = new L.polyline(this.route, {color: "#FF69B4", weight: 7});
            this.polyline.addTo(map);

            if(this.route.length > 0){
                if(!this.isStarted){
                    let start = new L.marker([this.route[0][0], this.route[0][1]], {icon: this.start_icon});
                    start.addTo(map);
                }

                if(this.isStarted)
                    map.removeLayer(this.car);

                let lastIndex = this.route.length - 1;

                //map.setView([this.route[lastIndex][0], this.route[lastIndex][1]]);

                this.car = new L.marker([this.route[lastIndex][0], this.route[lastIndex][1]], {icon: this.new_icon}).on('click', function() { alert('JA'); } );
                this.car.addTo(map);
                this.isStarted = true;
            }
        }
    }
}

